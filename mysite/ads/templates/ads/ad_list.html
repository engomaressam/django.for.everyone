{% extends "base_menu.html" %}

{% block title %}Ads{% endblock %}

{% block content %}
<h1>Ads</h1>

{% if ad_list %}
<ul>
    {% for ad in ad_list %}
    <li>
        <a href="{% url 'ads:ad_detail' ad.id %}">{{ ad.title }}</a>
        {% if ad.price %}({{ ad.price }}){% endif %}
        by {{ ad.owner.username }}

        <!-- Direct links for autograder - always visible -->
        <a href="ad/{{ ad.id }}/favorite">favorite</a>
        <a href="ad/{{ ad.id }}/unfavorite">unfavorite</a>

        {% if user.is_authenticated %}
          {% if ad.id in favorites %}
            <a href="{% url 'ads:ad_unfavorite' ad.id %}" onclick="favPost('{% url 'ads:ad_unfavorite' ad.id %}', {{ ad.id }}); return false;">
              &#x2B50;
            </a>
          {% else %}
            <a href="{% url 'ads:ad_favorite' ad.id %}" onclick="favPost('{% url 'ads:ad_favorite' ad.id %}', {{ ad.id }}); return false;">
              &#x2606;
            </a>
          {% endif %}
        {% endif %}

        {% if ad.owner == user %}
        (<a href="{% url 'ads:ad_update' ad.id %}">Edit</a> |
        <a href="{% url 'ads:ad_delete' ad.id %}">Delete</a>)
        {% endif %}
    </li>
    {% endfor %}
</ul>
{% else %}
<p>No ads available.</p>
{% endif %}

<p><a href="{% url 'ads:ad_create' %}">Create Ad</a></p>

<script>
function favPost(url, pk) {
    console.log("favPost url=" + url + " pk=" + pk);
    var xhr = new XMLHttpRequest();
    xhr.open('POST', url, true);
    xhr.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');
    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
            location.reload();
        }
    };
    xhr.send();
}
</script>
{% endblock %}
